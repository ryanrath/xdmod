services:
    xdmod:
        image: tools-ext-01.ccr.xdmod.org/xdmod:x86_64-rockylinux8.9.20231119-v11.0.0-1.0-03
        container_name: xdmod
        hostname: xdmod
        networks:
            - xdmod_network
        shm_size: 2g
        init: true
        ports:
            - 8080:443
            - 7000:7000
        environment:
            XDMOD_REALMS: 'jobs,storage,cloud,resourcespecifications'
            XDMOD_IS_CORE: true
        stdin_open: true
        tty: true
        command: sleep infinity
    playwright:
        image:  mcr.microsoft.com/playwright:v1.51.1-jammy
        hostname: playwright
        container_name: playwright
        networks:
            - xdmod_network
        init: true
        stdin_open: true
        tty: true
        ipc: host
        links:
            - xdmod
        depends_on:
            - xdmod
        environment:
            BASE_URL: https://xdmod
            XDMOD_REALMS: 'jobs,storage,cloud,resourcespecifications'
        command: sleep infinity
#    keycloak:
#      image: localhost:5000/keycloak_web:v1.0
#      build:
#        context: keycloak
#      container_name: keycloak
#      init: true
#      volumes:
#        - "./keycloak/exports/xdmod-realm-export.json:/opt/keycloak/data/import/xdmod-realm-export.json"
#      environment:
#        KC_BOOTSTRAP_ADMIN_USERNAME: admin
#        KC_BOOTSTRAP_ADMIN_PASSWORD: admin123
#        KC_LOG_LEVEL: "warning,org.keycloak.protocol.saml:trace,org.keycloak:debug,org.keycloak.transaction:warning,org.keycloak.timer:warning,org.keycloak.broker:warning,org.keycloak.quarkus:warning,org.keycloak.truststore:warning"
#        KC_HTTP_ENABLED: false
#        KC_TLS_HOSTNAME_VERIFIER: ANY
#        KC_HOSTNAME: https://keycloak:8443
#        KC_HOSTNAME_STRICT: false
#        KC_HOSTNAME_STRICT_BACKCHANNEL: false
#        KC_HOSTNAME_BACKCHANNEL_DYNAMIC: true
#        KC_HOSTNAME_DEBUG: true
#      command: start-dev --import-realm
#      depends_on:
#        - keycloak_db
#      ports:
#        - '8443:8443'
#      networks:
#        - xdmod_network
#    keycloak_db:
#      image: postgres:16
#      hostname: keycloak_db
#      container_name: keycloak_db
#      init: true
#      volumes:
#        - postgres_data_docker:/var/lib/postgresql/data
#      environment:
#        POSTGRES_DB: keycloak
#        POSTGRES_USER: keycloak
#        POSTGRES_PASSWORD: keycloak
#      networks:
#        - xdmod_network
networks:
  xdmod_network:
volumes:
  postgres_data_docker:
