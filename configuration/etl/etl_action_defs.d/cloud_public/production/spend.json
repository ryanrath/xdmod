{
    "table_definition": {
        "$ref": "${table_definition_dir}/cloud_public/production/spend.json#/table_definition"
    },
    "source_query": {
        "records": {
            "cloud_provider_id": "pc.cloud_provider_id",
            "account_id": "act.account_id",
            "location_id": "l.location_id",
            "service_id": "srv.service_id",
            "sub_service_id": "ssrv.sub_service_id",
            "start_day_id": "d.id",
            "end_day_id": "d.id",
            "date": "ss.date",
            "spend": "ss.spend"
        },
        "joins": [
            {
                "name": "staging_spend",
                "schema": "${SOURCE_SCHEMA}",
                "alias": "ss"
            },
            {
                "name": "cloud_providers",
                "schema": "${SOURCE_SCHEMA}",
                "alias": "pc",
                "on": "pc.name = ss.cloud_provider"
            },
            {
                "name": "accounts",
                "schema": "${SOURCE_SCHEMA}",
                "alias": "act",
                "on": "act.id = ss.account AND act.cloud_provider_id = pc.cloud_provider_id"
            },
            {
                "name": "locations",
                "schema": "${SOURCE_SCHEMA}",
                "alias": "l",
                "on": "l.name = ss.location AND l.cloud_provider_id = pc.cloud_provider_id"
            },
            {
                "name": "services",
                "schema": "${SOURCE_SCHEMA}",
                "alias": "srv",
                "on": "srv.name = ss.service AND srv.cloud_provider_id = pc.cloud_provider_id"
            },
            {
                "name": "sub_services",
                "schema": "${SOURCE_SCHEMA}",
                "alias": "ssrv",
                "on": "ssrv.name = ss.sub_service AND ssrv.service_id = srv.service_id AND ssrv.location_id = l.location_id"
            },
            {
                "name": "days",
                "schema": "modw",
                "alias": "d",
                "on": "ss.date BETWEEN d.day_start AND d.day_end"
            }
        ]
    }
}
